<!DOCTYPE html>
<html>
  <head>
    <title>geometrodash</title>
    <style>
      p 
      {
        font-family: Arial;
        color: brown;
      }
      .spelytan{
      margin-top: 300px;
        display: flex;
        justify-content: center;
      }
      .winer{
        font-size: 100px;
        color:brown;
      }
      .cool
       {
        display: flex;
        align-items: center;
        flex-direction: column;
        height: 100px;
       }
       button{
        width: 100px;
       }
       #score
       {
        color: blue;
        font-size: 30px;
       }
    </style>
  </head>
  <body>
    
    <div class="spelytan">    
      <canvas id="spelyta" width="2000" height="300" style="border: 1px solid black;"></canvas>
    </div>
    <div class="cool">
    <p>press D to start</p>
    <br>
    <p id="score"></p>
    <p id="death_count"></p>
    
    </div>

    
    <script>
      canvas = document.getElementById("spelyta");
      ctx = canvas.getContext("2d");
      let spikex = 10;
      let spikey = 25;
      let spikfart = 0;
      let rectangle = 275;
      let rectangle2 = 100;
      let g  = 0.21;
      let vy = 0;
      let falling = false
      let size = 25;
      let spel = false
      let score = 0
      let block = 2500
      let line = 1320
      let alive = true
      let size4 = size/4
      let best = 0
      let starttid = Date.now()
      let first = true
      let died = false;
      let deaths = 0;
      let img = new Image();
      img.src ="bilder/cube.png";
      let spikeimg = new Image();
      spikeimg.src ="bilder/spikar.png";
      let platformbild = new Image();
      platformbild.src = "bilder/platform.png";
      death_cube_original = [100, rectangle, size4, size4, 100+size4, rectangle, size4, size4, 100, rectangle+size4, size4, size4, 100+size4, rectangle+size4, size4, size4,]
      death_cube = [100, rectangle, size4, size4, 100+size4, rectangle, size4, size4, 100, rectangle+size4, size4, size4, 100+size4, rectangle+size4, size4, size4]
      wall_original = [250, 275, spikex, spikey, 280, 275, spikex, spikey, 310, 275, spikex, spikey, 450, 275, spikex, spikey, 465, 275, spikex, spikey, 700, 275, spikex, spikey, 719, 275, spikex, spikey, 738, 275, spikex, spikey, 880, 275, spikex, spikey, 1010, 275, spikex, spikey, 1140, 275, spikex, spikey, 1320, 275, spikex, spikey, 1350, 275, spikex, spikey, 1380, 275, spikex, spikey, 1410, 275, spikex, spikey, 1600, 275, spikex, spikey, 1750, 275, spikex, spikey, 1800, 275, spikex, spikey, 2000, 275, spikex, spikey, 2110, 275, spikex, spikey, 2250, 275, spikex, spikey, 2350, 280, spikex, spikey, 2490, 390, spikex, spikey, 2600, 265, spikex, spikey];
      wall = [250, 275, spikex, spikey, 280, 275, spikex, spikey, 310, 275, spikex, spikey, 450, 275, spikex, spikey, 465, 275, spikex, spikey, 700, 275, spikex, spikey, 719, 275, spikex, spikey, 738, 275, spikex, spikey, 880, 275, spikex, spikey, 1010, 275, spikex, spikey, 1140, 275, spikex, spikey, 1320, 275, spikex, spikey, 1350, 275, spikex, spikey, 1380, 275, spikex, spikey, 1410, 275, spikex, spikey, 1600, 275, spikex, spikey, 1750, 275, spikex, spikey, 1800, 275, spikex, spikey, 2000, 275, spikex, spikey, 2110, 275, spikex, spikey, 2250, 275, spikex, spikey, 2350, 280, spikex, spikey, 2490, 390, spikex, spikey, 2600, 265, spikex, spikey];
      deathspeeds = [Math.floor(Math.random() * 7) -3, Math.floor(Math.random() * 7) -3,2,2, Math.floor(Math.random() * 7) -3, Math.floor(Math.random() * 7) -3,2,2, Math.floor(Math.random() * 7) -3, Math.floor(Math.random() * 7) -3,2,2, Math.floor(Math.random() * 7) -3, Math.floor(Math.random() * 7) -3,2,2]
      document.addEventListener("keypress", function(event){
      if(event.key == "d")
      {
        line = 1320
        spikfart = 3;
        spel = true;
        alive = true
        wall = wall_original.slice();
        block = 2500
        starttid = Date.now()
        first = false;
        died=false;
      }
      if(event.key == "s") 
      {
        line = 1320
        block = 2500
        wall = wall_original.slice();
        alive = true;
        spikfart = 0;
        spel = false;
        first = true
        line = 1320
        died=false;
        starttid = Date.now()
      }
      if(spel == true)
      {
        if(rectangle >= 270)
      {
       if(event.key == " ") 
      {
        vy = -5.3;
        falling = true;
        
      }
      }
      }

      })
      
       function collision()
      {
        for(let i = 0; i<wall.length; i+=4)
      {
        if(wall[i]-size<rectangle2 && rectangle2<wall[i]+wall[i+2] && rectangle>wall[i+1]-size && rectangle<wall[i+1]+wall[i+3]) return true;
        
      }

      return false;

      }

      function collision_death_x(i)
      {
        
      if(death_cube[i]>canvas.width-size4 || death_cube[i]<0) 
      {
        console.log(death_cube[i])
        return true;
      }
      
      return false;

      }
      function collision_death_y(i)
      {
        if(death_cube[i+1]> canvas.height-size4 || death_cube[i+1] < 0 ) return true;

        return false;
      }


       function winner()
       {
      
      if(rectangle2 > block-size && rectangle2<block+20 && rectangle> 200-size && rectangle<200+100)
      {
        console.log("win")
        return true;
      }
      return false;
      }

      function gamestart()
      {
        line = 1320
        spikfart = 3;
        spel = true;
        alive = true
        wall = wall_original.slice();
        block = 2500
      }
      
      function platform()
      {
        if(rectangle2 >line-size && rectangle2 < line + 100 && rectangle > 260 -size && rectangle < 260 + 10)
      {
        return true;
      }
        return false;
      }

      function dead()
      {
        for(let i = 0; i<wall.length; i+=4)
      {
        if(wall[i]-size<rectangle2 && rectangle2<wall[i]+wall[i+2] && rectangle>wall[i+1]-size && rectangle<wall[i+1]+wall[i+3]) return true;
      }
        return false;
      }
      


      function run()
      {
        var gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        gradient.addColorStop(0, "rgb(57, 255, 20)");
        gradient.addColorStop(1, "rgb(173, 216, 230)");
        ctx.fillStyle=gradient;
        ctx.fillRect(0,0,canvas.width,canvas.height)

        if(first == true)
      {
        ctx.font = "80px arial";
        ctx.fillStyle = "blue"
        ctx.fillText("PRESS D TO START GAME", 500, 100)
      }
      


       
        ctx.fillStyle="red";
        if(alive)
        {ctx.drawImage(img, 100, rectangle)}
        else
        {
           for(let i=0; i<death_cube.length; i+=4)
        {
          ctx.fillRect(death_cube[i], death_cube[i+1], death_cube[i+2], death_cube[i+3]);

        }
        }
        ctx.fillStyle="rgb(57, 255, 20)"
        ctx.fillRect(block, 200, 20, 100)
        ctx.fillStyle="green"
        ctx.drawImage(platformbild ,line, 260)
        ctx.fillStyle="black"
        if(falling == true)
        {
        vy += g;
        rectangle += vy;
        }
        if(rectangle >= 277)
        {
          falling = false;
          rectangle = 277;
        }
         line -= spikfart;
         block -= spikfart;
        for(let i=0; i<wall.length; i+=4)
        {
          //ctx.fillRect(wall[i], wall[i+1], wall[i+2], wall[i+3]);
          wall[i] -= spikfart;
          ctx.drawImage(spikeimg,wall[i]-5,wall[i+1])
        }
        
        for(let i=0; i<death_cube.length; i+=4)
        {

            if(collision_death_x(i) == true)
        {
          deathspeeds[i] = deathspeeds[i]*(-1)
        }
        }
      
                for(let i=0; i<death_cube.length; i+=4)
        {

            if(collision_death_y(i) == true)
        {
          deathspeeds[i+1] = deathspeeds[i+1]*(-1)
        }
        }
        if(collision() == true)
        { 
          ctx.font = "100px arial";
          ctx.fillStyle = "brown"
          ctx.fillText("YOU LOST THE GAME", 500, 100);
          ctx.fillStyle = "red"
          ctx.font = "40px arial"
          ctx.fillText("Press S to try again?", 850, 150);
          block = 2500
          rectangle = 275
          spikfart = 0;
          spel = false
          if(died == false)
          {
            died = true;
            deaths += 1;
            document.getElementById("death_count").textContent = deaths + " Deaths"
          }
          alive = false
          if(Date.now()-starttid > best)
        {
          best = Date.now()-starttid;
          document.getElementById("score").textContent = "High score: " + best
        }
        starttid = Date.now()
        }
        
        
        //death cube animation
           for(let i=0; i<death_cube.length; i+=4)
        {
        if(alive == false)
        {
          death_cube[i] -= deathspeeds[i]
          death_cube[i+1] -= deathspeeds[i+1]
        }
        }

        //death cube respawn

        if(alive == true)
        {
          death_cube = death_cube_original.slice();
          
        }



        if(winner() == true)
        {
          ctx.font = "100px arial";
          ctx.fillStyle = "brown"
          ctx.fillText("YOU WON THE GAME", 500, 100);
          ctx.fillStyle = "green"
          ctx.font = "40px arial"
          ctx.fillText("Press S to try again?", 850, 150);
          rectangle = 275
          spikfart = 0;
          spel = false
          wall=wall_original.slice();
          if(Date.now()-starttid > best)
        {
          best = Date.now()-starttid;
          document.getElementById("score").textContent = "High score: " + best
        }
          starttid = Date.now()
        }
        if(platform() == true)
        {
          rectangle = 235
          vy = 0
          falling = false;
        }
        if(platform() == false)
        {
          falling = true;
        } 
        

        requestAnimationFrame(run)
      }
      
      starttid = Date.now();

      run()


    </script>

  </body>
</html>